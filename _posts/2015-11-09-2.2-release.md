---
layout: post
title: "RethinkDB 2.2: atomic changefeeds, improved performance, smaller memory footprint"
author: Ryan Paul
author_github: segphault
---

Today, we're pleased to announce the availability of RethinkDB 2.2 (Codename). [Download it now][download]!

The RethinkDB 2.2 release includes over XX improvements from XX contributors. It offers several noteworthy changes: improved performance and scalability, lower memory overhead, and support for atomic changefeeds.

## Atomic changefeeds

Originally introduced in RethinkDB 1.16 to simplify realtime application development, changefeeds provide a way to receive a stream of live updates from a query. Encouraged by rapid adoption of the feature, we made many improvements to our changefeed implementation to support the increasingly diverse range of usage scenarios envisioned by our users.

<!--more-->

The most significant new feature in RethinkDB 2.2 is an option that makes it possible to use a single query to both retrieve current data and subscribe to a live stream of subsequent changes. Previous versions of the database often required developers to use two separate queries to perform the same operation, risking the possibility of missing updates that happen in between.

Developers can now pass the `includeInitial` option to the `changes` command to specify whether they want a changefeed to return the initial results. The option tells the changefeed to immediately emit the results of the query when the changefeed opens. The application will receive the initial results in the changefeed cursor as though they are updates. Consider the following example, which you could use to display a leaderboard in a realtime game:

```javascript
r.db("game").table("players"))
 .orderBy({index: r.desc("score")}).limit(10)
 .changes({includeInitial: true})
```

The example above will give you the ten players with the highest scores, in descending order. After it gives you the initial list, it will give you a stream of updates as the players scores change or when they are displaced by other players.

In previous versions of RethinkDB, changefeeds automatically include initial results for some queries (like the one above that uses `orderBy` and `limit` together) but not others. There was no way to demand the behavior or to inhibit it when it was undesired. In RethinkDB 2.2, changefeeds only emit their initial results by default if you explicitly use the `includeInitial` option.

This update makes changefeed behavior consistent across all queries. Please note that this is a potentially breaking change for some users: you might need to update your applications accordingly if you relied on the previous default behavior.

The availability of initial changefeed results will further simplify realtime application development for many RethinkDB users, but it's especially worth noting that this feature brings us one big step closer to accommodating the requirements of the popular Meteor framework.

## Performance improvements

In addition to atomic changefeeds, the 2.2 release also brings a number of significant performance improvements. In particular, you can expect to see [major performance gains][index-optimizations] for operations that rely on secondary indexes. In our internal benchmarks, a query that uses an index to count a million items went from 1.3 seconds in RethinkDB 2.1.0 to 0.5 seconds in 2.2.

We also worked to deliver better performance in cases where users stream large data sets with the Python client driver. An operation that involves reading 1 million documents that are roughly 200 bytes each went from 20 seconds in version 2.1 to 9.1 seconds in version 2.2.

Community member Adam Grandquist [contributed code][json-interface] that extends the Python client driver so that users can plug in third-party JSON parsing libraries like RapidJSON for faster document decoding. When we added RapidJSON to our benchmark configuration, the completion time of the million document benchmarked dropped even further, down to 6.7 seconds.

We've also significantly [reduced the memory][memory-reduction] overhead incurred when working with large datasets that are too big to fit in memory. Users can expect to see about 50% less memory consumed. 

## Download RethinkDB 2.2 today

For more details check out the [official release notes](#). To try the new release for yourself, [download and install](#) it today.

* Download [RethinkDB 2.2][download]
* Reach us on [Twitter][twitter]
* Start a thread in [our Google Group][group]
* Join us in the [#rethinkdb channel on Freenode][freenode]
* Read the [`includeInitial` documentation](#)

[index-optimizations]: https://github.com/rethinkdb/rethinkdb/issues/4862
[json-interface]: https://github.com/rethinkdb/rethinkdb/pull/4825
[memory-reduction]: https://github.com/rethinkdb/rethinkdb/issues/1951
[twitter]: https://twitter.com/rethinkdb
[group]: https://groups.google.com/forum/#!forum/rethinkdb
[freenode]: irc://chat.freenode.net/#rethinkdb
[download]: #

